---
title: "Gráficos ggplot"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



```{r}
library(readxl)
library(ggplot2)
library(dplyr)
library(tidyr)

mipaleta <- c("#B90073", "#C888E0", "#FF009E", "#59D9FF" , "#0027FF", "#E1B6EA", "#A3BFE8", "#C8D9F3")
plot(1:8, pch = 20, cex = 4, col=mipaleta)
# IPV 
ipvm <- as.data.frame(read_excel("ipv1.xls")) 
ipvm

ipvm %>% ggplot(aes(x = `Periodo (Trimestral)`, y = IPV)) +
  geom_vline(xintercept = seq(4,60, by = 4), size = 0.01, col = mipaleta[8]) +
  geom_line(group = "",  col =mipaleta[2], size = 1.8) + scale_x_discrete() +
  theme_minimal()+
  labs(y = "Variación anual")+
  labs(x = "Periodo (Trimestral)")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))

# IPV Según tipo de vivienda
ipv2 <- as.data.frame(read_excel("ipv2.xls")) 

ipv2

ipv2 %>% 
  gather(key = "Tipo", value = "IPV", -Periodo) %>% 
  ggplot(aes(x = Periodo, y = IPV , group = Tipo)) +
  geom_line(aes(color = Tipo), size = 1.3) + 
  scale_color_manual(values = c("#D670F0","#8FE1E8")) +
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 60, hjust = 1, size = 10))  +
  labs(y = "Variación anual")+
  labs(x = "Periodo (Trimestral)")


# importe medio de las tasaciones en España, EXPRESADO EN MILLONES DE EUROS 
imp2 <- as.data.frame(read_excel("importe_tas2.xls")) 


imp2 %>% ggplot(aes(x = Año, y = Valor_total_tasaciones)) +
  geom_line(group = "",  col =mipaleta[2], size = 1.5 ) +
  theme_minimal()+
  labs(y = "Millones de euros")+
  labs(x = "Año") 

mipaleta <- c("#59D9FF" , "#E1B6EA")
plot(1:17, pch = 20, cex = 4, col=mipaleta)


#importe medio de tasacion por vivienda y comunidades autonomas EN MILES DE EUROS

pmtv <- as.data.frame(read_excel("importe_tas_ccaa.xlsx"))

pmtv
library(dplyr)
pmtv %>% 
  gather(key = "CCAA", value = "Importe_medio_tasación", -Año) %>% 
  mutate(Importe_medio_tasacion_miles = Importe_medio_tasación/1000) %>% 
  ggplot(aes(x = Año, y = Importe_medio_tasacion_miles , group = CCAA)) +
  geom_line(aes(color = CCAA), size = 1.3) + 
  scale_color_manual(values = c("#FF00A6","#C888E0","#C54293", "#A700F5", "#FD839C", "#27F9FF" , "#F30CF3", "#80FCFC", "#33B7F9", "#FF1C94", "#ECA8CC", "#E080B3", "#DB33F9", "#F682E1", "#FD839C", "#59D9FF" , "#3354F9")) +
  theme_minimal() +
  labs(y = "Millones de euros")+
  theme_minimal()



#Número de tasaciones realizadas en españa según el periodo!!!!! bde DE VIVIENDAS
nts <- as.data.frame(read_excel("num_tas_es.xlsx")) 

nts %>% ggplot(aes(x = Año, y = num_tas/1000)) +
  geom_line(group = "",  col =mipaleta[3], size = 1.5 ) +
  theme_minimal()+
  labs(y = "Numero de tasaciones (en miles)")


#numero de tasaciones DE VIVIENDAS por CCAA
it <- as.data.frame(read_excel("num_tas__ccaa.xlsx"))

it

it %>% 
  gather(key = "CCAA", value = "Numero_medio_tasación", -Año) %>% 
  mutate(Numero_medio_tasacion_miles = Numero_medio_tasación) %>% 
  ggplot(aes(x = Año, y = Numero_medio_tasacion_miles , group = CCAA)) +
  geom_line(aes(color = CCAA), size = 1.3) + 
  scale_color_manual(values = c("#80FCFC", "#33B7F9", "#FF1C94", "#ECA8CC", "#E080B3", "#DB33F9", "#F682E1","#FF00A6","#C888E0","#C54293", "#A700F5", "#FD839C", "#27F9FF" , "#F30CF3",  "#FD839C", "#59D9FF" , "#3354F9")) +
  theme_minimal() +
  labs(y = "Número de tasaciones ")



#Coste medio de tasación por por municipios

pmtv2 <- as.data.frame(read_excel("Tasaciones_pormun.xlsx"))

pmtv2

pmtv2 %>% 
  gather(key = "Municipios", value = "Importe_medio_tasación", -Año) %>% 
  ggplot(aes(x = Año, y = Importe_medio_tasación , group = Municipios)) +
  geom_line(aes(color = Municipios), size = 1.3) + 
  scale_color_manual(values = c("#C888E0", "#FF009E", "#59D9FF" , "#0027FF")) +
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5, size = 10))+
  labs(y = "Coste medio (expresado en miles de euros)")


#tasacion por tipo de cliente:
tc <- as.data.frame(read_excel("num_tas_cli.xlsx"))

tc

tc %>% 
  gather(key = "Cliente", value = "num_tasación", -Año) %>% 
  mutate(num_tasación_miles = num_tasación/1000) %>% 
  ggplot(aes(x = Año, y = num_tasación_miles , group = Cliente)) +
  geom_line(aes(color = Cliente), size = 1.3) + 
  scale_color_manual(values = c("#C888E0", "#FF009E", "#59D9FF" , "#0027FF")) +
  theme_minimal() +
  labs(y = "Número de tasaciones (en miles)")


#finalidad tas, hacerlo con gráfico de barras y % de colores.

ft <- as.data.frame(read_excel("finalidad_tas.xlsx"))

ft

ft2 <- ft %>% 
  gather("Finalidad", "Porcentaje", -Año) 


mipaleta <- c("#B90073", "#C888E0", "#FF009E", "#59D9FF" , "#0027FF", "#E1B6EA", "#A3BFE8", "#C8D9F3")
plot(1:8, pch = 20, cex = 4, col=mipaleta)

library(ggplot2)
ggplot(ft2, aes(x = Año, y = Porcentaje, fill = Finalidad)) + 
  geom_bar(position = "fill", stat="identity")+
  scale_fill_manual(values=c("Compra-Venta" = "#8C42FF", "Otras finalidades" = "#C888E0", "Garantía Hipotecaria"="#39EDFC", "Requeridas por Normativa Contable" = "#FF0097"))+
  theme_minimal()




```

